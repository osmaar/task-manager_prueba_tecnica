<mat-card
  class="task-item"
  [ngClass]="{
    completed: task().completed,
    'high-priority': task().priority === 'high',
    'medium-priority': task().priority === 'medium',
    'low-priority': task().priority === 'low'
  }"
>
  <mat-card-content class="task-content">
    <!-- Completion Checkbox -->
    <div class="task-checkbox">
      <mat-checkbox
        [checked]="task().completed"
        (change)="onToggleComplete()"
        [disabled]="isLoading"
        color="primary"
        matTooltip="Mark as {{
          task().completed ? 'Incompleta' : 'Completada'
        }}"
      ></mat-checkbox>
    </div>

    <!-- Task Information -->
    <div class="task-info">
      <div class="task-header">
        <h3
          class="task-title"
          [ngClass]="{ 'completed-text': task().completed }"
        >
          {{ task().title }}
        </h3>

        <!-- Priority Chip -->
        <mat-chip-set>
          <mat-chip
            [ngClass]="'priority-' + task().priority"
            [matTooltip]="getPriorityTooltip()"
          >
            <mat-icon>{{ getPriorityIcon() }}</mat-icon>
            {{ getPriorityText() }}
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Task Description -->
      <p
        *ngIf="task().description"
        class="task-description"
        [ngClass]="{ 'completed-text': task().completed }"
      >
        {{ task().description }}
      </p>

      <!-- Task Metadata -->
      <div class="task-metadata">
        <div class="metadata-item">
          <mat-icon class="metadata-icon">schedule</mat-icon>
          <span class="metadata-text">
            Creada: {{ task().createdAt | date : "MMM dd, yyyy" }}
          </span>
        </div>

        <div
          *ngIf="task().dueDate"
          class="metadata-item due-date"
          [ngClass]="{ overdue: isOverdue() }"
        >
          <mat-icon class="metadata-icon">event</mat-icon>
          <span class="metadata-text">
            Fecha: {{ task().dueDate | date : "MMM dd, yyyy" }}
          </span>
          <mat-icon
            *ngIf="isOverdue()"
            class="warning-icon"
            matTooltip="La tarea estÃ¡ atrasada"
          >
            warning
          </mat-icon>
        </div>

        <div
          *ngIf="task().updatedAt !== task().createdAt"
          class="metadata-item"
        >
          <mat-icon class="metadata-icon">update</mat-icon>
          <span class="metadata-text">
            Actualizado:
            {{ task().updatedAt | date : "MMM dd, yyyy HH:mm" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Task Actions -->
    <div class="task-actions">
      <button
        mat-icon-button
        [matMenuTriggerFor]="taskMenu"
        matTooltip="Opciones de tarea"
        [disabled]="isLoading"
      >
        <mat-icon>more_vert</mat-icon>
      </button>

      <!-- Task Menu -->
      <mat-menu #taskMenu="matMenu">
        <button
          mat-menu-item
          (click)="onToggleComplete()"
          [disabled]="isLoading"
        >
          <mat-icon>{{ task().completed ? "undo" : "check" }}</mat-icon>
          <span>{{
            task().completed ? "Marcar Incompleta" : "Marcar Completa"
          }}</span>
        </button>

        <button
          mat-menu-item
          (click)="onEditTask()"
          [disabled]="isLoading"
        >
          <mat-icon>edit</mat-icon>
          <span>Editar Tarea</span>
        </button>

        <mat-divider></mat-divider>

        <button
          mat-menu-item
          (click)="onDeleteTask()"
          class="delete-action"
          [disabled]="isLoading"
        >
          <mat-icon>delete</mat-icon>
          <span>Eliminar Tarea</span>
        </button>
      </mat-menu>

      <!-- Quick Actions -->
      <button
        mat-icon-button
        color="primary"
        (click)="onToggleComplete()"
        [disabled]="isLoading"
        [matTooltip]="
          task().completed ? 'Marcar como incompleta' : 'Marcar como terminada'
        "
      >
        <mat-icon>{{ task().completed ? "undo" : "check" }}</mat-icon>
      </button>

      <button
        mat-icon-button
        color="accent"
        (click)="onEditTask()"
        [disabled]="isLoading"
        matTooltip="Editar tarea"
      >
        <mat-icon>edit</mat-icon>
      </button>

      <button
        mat-icon-button
        color="warn"
        (click)="onDeleteTask()"
        [disabled]="isLoading"
        matTooltip="Eliminar tarea"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </mat-card-content>
</mat-card>
